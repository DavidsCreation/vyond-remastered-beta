<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<link rel="icon" href="../../favicon.ico" type="image/png">
	<title>Settings</title>
	<meta name="description" content="Vyond: Remastered's Settings Page">
	<link rel="stylesheet" type="text/css" href="../css/modern-normalize.css">
	<link rel="stylesheet" type="text/css" href="../css/global.css">
	<link rel="stylesheet" type="text/css" href="../css/list.css">
	<link rel="stylesheet" type="text/css" href="../css/window.css">
	<style>
		.green {
			color: rgb(0, 255, 0);
		}
		.red {
			color: rgb(255, 0, 0);
		}
	</style>
    <script src="../js/jquery.js"></script>
	<script src="https://josephanimate2021.github.io/blockui/jquery.blockUI.js"></script>
</head>
<body onload="loadSettings()">
	<header>
		<a href="/">
			<h1 style="margin:0"><img id="logo" src="../img/list_logo.png" alt="Vyond: Remastered"/></h1>
		</a>
		<nav id="headbuttons">
			<div class="dropdown_contain button_small">
				<div class="dropdown_button upload_button">UPLOAD</div>
				<nav class="dropdown_menu">
					<a onclick="document.getElementById('file').click()">Movie</a>
					<a onclick="document.getElementById('file2').click()">Character</a>
					<a onclick="document.getElementById('file3').click()">Watermark</a>
				</nav>
			</div>	
			<div class="dropdown_contain button_small">
				<div class="dropdown_button">CREATE A CHARACTER</div>
				<nav class="dropdown_menu">
					<h2>Comedy World</h2>
					<a href="/cc?themeId=family&bs=adam">Guy (Adam)</a>
					<a href="/cc?themeId=family&bs=eve">Girl (Eve)</a>
					<a href="/cc?themeId=family&bs=bob">Fat (Bob)</a>
					<a href="/cc?themeId=family&bs=rocky">Buff (Rocky)</a>
					<hr />
					<h2>Business Friendly</h2>
					<a href="/cc?themeId=business&bs=default&ft=_sticky_filter_guy">Guy (Adam)</a>
					<a href="/cc?themeId=business&bs=default&ft=_sticky_filter_girl">Girl (Eve)</a>
					<a href="/cc?themeId=business&bs=heavy&ft=_sticky_filter_heavyguy">Fat (Bob)</a>
					<hr />
					<h2>Anime</h2>
					<a href="/cc?themeId=anime&bs=guy">Guy</a>
					<a href="/cc?themeId=anime&bs=girl">Girl</a>
					<a href="/cc?themeId=ninjaanime&bs=guy">Guy (Ninja)</a>
					<a href="/cc?themeId=ninjaanime&bs=girl">Girl (Ninja)</a>
					<hr />
					<h2>Peepz</h2>
					<a href="/cc?themeId=cc2&bs=default">Lil Peepz</a>
					<a href="/cc?themeId=chibi&bs=default">Chibi Peepz</a>
					<a href="/cc?themeId=ninja&bs=default">Chibi Ninjas</a>
				</nav>
			</div>
			<div class="dropdown_contain button_small">
				<div class="dropdown_button">BROWSE CHARACTERS</div>
				<nav class="dropdown_menu">
					<h2>Comedy World</h2>
					<a href="/cc_browser?themeId=family">Comedy World</a>
					<hr />
					<h2>Anime</h2>
					<a href="/cc_browser?themeId=anime">Anime</a>
					<a href="/cc_browser?themeId=ninjaanime">Ninja Anime</a>
					<hr />
					<h2>Peepz</h2>
					<a href="/cc_browser?themeId=cc2">Lil' Peepz</a>
					<a href="/cc_browser?themeId=chibi">Chibi Peepz</a>
					<a href="/cc_browser?themeId=ninja">Chibi Ninjas</a>
				</nav>
			</div>
			<a href="create.html" class="button_big">MAKE A VIDEO</a>
		</nav>
	</header>
	<div id="shade"></div>
	<div id="modal"></div>
	<main>			
		<nav class="tabs_contain">
			<div class="tab_buttons">
				<h1 id="settings">Settings</h1>
				<a href="#" class="button_big">Features</a><br>
				<a id="cmdSettingsEdit" href="javascript:openSettingsInCMD()" class="button_big inactive">Edit Some Settings</a>
			</div>
			<nav class="tab">
				<h2>Features</h2>
				<p>Waveforms: <a id="waveform" title="Update Setting"></a></p>
				<p>Resolution: <a id="resolution" title="Update Setting" style="color: white;"></a></p>
                <p>Discord RPC: (Requires a restart after the setting is changed) <a id="rpc" title="Update Setting"></a></p> 
				<div id="cmdSettings"></div>
				<div id="devSettings" style="display: none;">
					<h4>Developer Settings (You all should know what y and n means because you all are devs lol) To access Developer Settings, please type masterkey on the settings.bat file.</h4>
					<p>Installing dependencies: <a id="installDepends" href="javascript:moreInfo('installDepends')" title="More Info"></a></p>
					<p>Dry run mode: <a id="dryrun" href="javascript:moreInfo('dryrun')" title="More Info"></a></p>
					<p>Browser type: <a id="btype" href="javascript:moreInfo('btype')" title="More Info"></a></p>
				</div>
				<p>LVM Type: <a id="lvmType" title="Update Setting" style="color: white;"></a></p>
				<p id="stype_p">Studio Type: <a id="stype" title="Update Setting"></a></p>
				<p id="tutorial-setting" style="display:none">Tutorial: <a id="tutorial" title="Update Setting"></a></p>
				<p id="atype_p">Api Type: <a id="atype" title="Update Setting"></a></p>
				</p>
			</nav>
		</nav>
	</main>

	<footer>
        <nav id="foot-left">
            <a>v2.5.0</a>
            <a href="https://discord.gg/ErwfsXGCxr">Discord</a>
            <a href="./settings.html">Settings</a>
        </nav>
    </footer>
</body>
<form enctype='multipart/form-data' action='/upload_movie' method='post'>
	<input id='file' type="file" onchange="this.form.submit()" name='import' />
</form>

<form enctype='multipart/form-data' action='/upload_character' method='post'>
	<input id='file2' type="file" onchange="this.form.submit()" name='import' />
</form>

<form enctype='multipart/form-data' action='/api/asset/upload' method='post'>
	<input type="hidden" name="type" value="watermark"/>
	<input id='file3' type="file" onchange="this.form.submit()" name='import' />
</form>
	<script>
		function getCookie(c) {
			var b = document.cookie;
			var f = c + "=";
			var e = b.indexOf("; " + f);
			if (e == -1) {
				e = b.indexOf(f);
				if (e != 0) return null
			} else e += 2
			var a = document.cookie.indexOf(";", e);
			if (a == -1) a = b.length
			return unescape(b.substring(e + f.length, a))
		}
		function displayFeedback(msg) {
			$.growlUI('Notification', msg);
		}
        /*
        list
        */
        function loadSettings() {
            $.getJSON("/api/settings/list", (d) => {
				let text;
                if (d.waveform == "true") {
                    document.getElementById('waveform').innerHTML = 'ON';
                    document.getElementById('waveform').href = "javascript:changeSetting('waveform', 'false')";
					$("#waveform").removeClass("red");
					$("#waveform").addClass("green");
                } else {
                    document.getElementById('waveform').innerHTML = 'OFF';
                    document.getElementById('waveform').href = "javascript:changeSetting('waveform', 'true')";
					$("#waveform").removeClass("green");
					$("#waveform").addClass("red");
                }
				if (d.resolution == "1") {
                    document.getElementById('resolution').innerHTML = '16:9';
                    document.getElementById('resolution').href = "javascript:changeSetting('resolution', '0')";
                } else {
                    document.getElementById('resolution').innerHTML = '14:9';
                    document.getElementById('resolution').href = "javascript:changeSetting('resolution', '1')";
                }
				if (d.rpc == "true") {
                    document.getElementById('rpc').innerHTML = 'ON';
                    document.getElementById('rpc').href = "javascript:changeSetting('rpc', 'false')";
					$("#rpc").removeClass("red");
					$("#rpc").addClass("green");
					$.post("/api/setDiscordStatus", {status: "Changing some settings"});
                } else {
                    document.getElementById('rpc').innerHTML = 'OFF';
                    document.getElementById('rpc').href = "javascript:changeSetting('rpc', 'true')";
					$("#rpc").removeClass("green");
					$("#rpc").addClass("red");
                }
				switch (d.studio.filename) {
					case "studio": {
						text = "Modified (Default)";
						$("#atype_p").show();
						$("#tutorial-setting").hide();
						break;
					} case "studio_legacy": {
						text = "Legacy (Recomended For LVM Veterans)";
						$("#atype_p").hide();
						$("#tutorial-setting").show();
						break;
					}
				}
				document.getElementById('stype').href = `javascript:changeStype('${d.studio.filename == "studio" ? 'studio_legacy' : 'studio'}')`;
				$("#stype").html(text).css("color", "white");
				$("#year").find(`#${d.year}`).prop("selected", true);
            });
			$("#year").change(() => {
				changeSetting('year', $("#year").val())
			})
			$.getJSON("/api/env/get", (d) => {
				if (d.OS_USED != "Windows") {
                    $("#cmdSettings").hide();
					$("#cmdSettingsEdit").hide();
                }
				$("#cmdSettings").html(`<h4>Rest of the settings. <a id="restOfSettings_button" style="color: white" href="javascript:loadText('restOfSettings', 'block')">Load more...</a><br><div id="restOfSettings" style="display:none">(can only be edited using cmd and needs to be refreshed after changes were made to these settings via cmd)</div></h4><p>Verbose Mode: <a id="vbwrapper" title="More Info" href="javascript:moreInfo('vbwrapper')">${d.vbwrapper}</a></p> <p>Checking dependencies: <a id="dpends" title="More Info" href="javascript:moreInfo('dpends')">${d.dpends}</a></p>`);
				$("#vbwrapper").addClass(d.vbwrapperColor);
				$("#dpends").addClass(d.dpendsColor);
				$("#installDepends").html(d.SKIPDEPENDINSTALL).css("color", "white");
				$("#dryrun").html(d.DRYRUN).css("color", "white");
				$("#btype").html(d.BROWSER_TYPE).css("color", "white");
				if (d.NODE_ENV == "dev") $("#devSettings").show();
			});
			$.post("/api/config/get").done(d => {
				const json = JSON.parse(d);
				let text;
				switch (json.lvmType) {
					case "go_full": {
						text = "Vyond Remastered LVM (Modified Version)"
						document.getElementById('lvmType').href = "javascript:changeConfigSetting('lvmType', 'go_full2')";
						break;
					} case "go_full2": {
						text = "Original GoAnimate LVM (Unmodified Version)";
						document.getElementById('lvmType').href = "javascript:changeConfigSetting('lvmType', 'go_full')";
						break;
					}
				}
				$("#lvmType").html(text);
			})
			$.post("/api/info/get").done(d => {
				const json = JSON.parse(d);
				if (
					json.GET["/index.html"].headers.Location == "/pages/html/list.html" && 
					json.GET["/$"].headers.Location == "/pages/html/list.html" && 
					json.GET["/dashboard/videos"].headers.Location == "/pages/html/list.html"
				) {
					$("#atype").html("VR (Default) [Requires a restart to actually change this setting]").css("color", "orangered");
					$("#stype_p").show();
					document.getElementById('atype').href = "javascript:changeRedirType('_html_list-html')";
				} else if (
					json.GET["/index.html"].headers.Location == "/html/list.html" && 
					json.GET["/$"].headers.Location == "/html/list.html" && 
					json.GET["/dashboard/videos"].headers.Location == "/html/list.html"
				) {
					$("#atype").html("GoAnimate Wrapper [Requires a restart to actually change this setting]").css("color", "blue");
					$("#stype_p").hide();
					document.getElementById('atype').href = "javascript:changeRedirType('_pages_html_list-html')";
				}
			});
			loadSettings2();
        }
		function loadSettings2() {
			const cookie = getCookie("studio_interactive_tutorial");
			if (cookie !== "skip") {
				$("#tutorial").html("ON").css("color", "green");
				document.getElementById('tutorial').href = `javascript:changeTutorialSetting('skip')`;
			} else {
				$("#tutorial").html("OFF").css("color", "red");
				document.getElementById('tutorial').href = `javascript:changeTutorialSetting('show')`;
			}
		}
		function changeRedirType(pathString) {
			const pieces = pathString.split("_");
			const slash = pieces.join("/");
			const pieces2 = slash.split("-");
			const build = pieces2.join(".");
			$.post("/api/info/update", {build}).done(() => loadSettings());
		}
		function changeConfigSetting(type, value) {
			$.post("/api/config/save", {type, value}).done(() => loadSettings());
		}
		function loadText(id, type) {
			document.getElementById(id).style.display = type;
			document.getElementById('restOfSettings_button').href = `javascript:loadText('restOfSettings', '${type != "block" ? "block" : "none"}')`;
			document.getElementById('restOfSettings_button').innerHTML = type != "block" ? "Load more..." : "Load less...";
		}
		function hideModal() {
			$("#shade").hide();
			$("#modal").hide();
		}
		function moreInfo(id) {
			document.getElementById('restOfSettings').style.display = 'none';
			document.getElementById('restOfSettings_button').href = `javascript:loadText('restOfSettings', 'block')`;
			document.getElementById('restOfSettings_button').innerHTML = "Load more...";
			let text = `<center><button onclick="hideModal()">Close</button><br><p class="window_p">`;
			switch (id) {
				case 'vbwrapper': {
					text += `When enabled, you will have two extra windows with more info about what Vyond Remastered is doing.<br>
	The launcher will also say more about what it's doing and never clears itself.<br>
	Mostly ment for troubleshooting and development. Default setting is off. <br>During development, this will be turned on by default.`;
					break;
				} case 'dpends': {
					text += `Turning this off skips checking for Flash, Node.js, http-server, and if the HTTPS cert is installed.<br>
	This is automatically disabled when Vyond Remastered launches and finds all dependencies.<br>
	If you're on a new computer or having issues with security messages, you may wanna turn this back on.<br>`;
					break;
				} case "installDepends": {
					text += `Disabling this will still check for dependencies, but won't install them.<br>
I'm not sure why I added this, but I don't have a reason to take it out.`;
                    break;
				} case "dryrun": {
					text += `Turning this on will run through all of the launcher's code without affecting anything.<br>
Useful for debugging the launcher without uninstalling things and all that.`;
					break;
				} case "btype": {
					text += `Tells the launcher what kind of browser is in use. Should be autoset by CUSTOMBROWSER.<br>
Mostly used by the Flash installer to tell what version to install.`;
                    break;
				}
			}
			$("#shade").show();
			$("#modal").html(text + '</p></center>').show();
		}
        /*
		toggle
		*/
		function changeSetting(type, value) {
            $.post("/api/settings/update", { type, value }).done((d) => {
                const json = JSON.parse(d);
                if (json.status != "ok") {
                    alert("That didn't work.", json.msg);
                } else {
                    if (value) document.getElementById(type).href = `javascript:changeSetting('${type}', 'false')`;
                    else document.getElementById(type).href = `javascript:changeSetting('${type}', 'true')`;
                    loadSettings();
                }
            });
		}
		function changeStype(value) {
			$.post("/api/settings/update", {changeStudioType: true, filename: value}).done((d) => {
				const json = JSON.parse(d);
				if (json.status != "ok") alert("That didn't work.", json.msg);
				else loadSettings();
			});
		}
		function changeTutorialSetting(b) { // sets a cookie for the interactive tutorial in the legacy lvm in html 5.
			SetCookie("studio_interactive_tutorial", b, 500, "/");
			// reload settings
			loadSettings2();
		}
		function openSettingsInCMD() {
            $.post("/api/settings/cmd/open");
		}
	</script>
</html>